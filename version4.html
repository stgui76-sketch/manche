<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cercle des Quintes ‚Äì Version 4 compl√®te</title>
<style>
:root{
  --bg-light: linear-gradient(135deg,#f8fafc,#dbe4f3);
  --bg-dark: linear-gradient(135deg,#1c1f26,#212830);
  --card-light: rgba(255,255,255,0.25);
  --card-dark: rgba(60,60,70,0.5);
}
body{
  margin:0; font-family: Poppins, sans-serif;
  background: var(--bg-light); color:#333;
  transition:.4s;
}
body.dark{ background:var(--bg-dark); color:#eee; }

header{display:flex;justify-content:space-between;align-items:center;padding:15px 30px;backdrop-filter:blur(6px);}
button{border:none;border-radius:10px;padding:10px 16px;cursor:pointer;background:rgba(255,255,255,0.2);color:inherit;transition:.3s;}
button:hover{background:rgba(0,0,0,0.15);}

.container{display:flex;flex-direction:column;align-items:center;margin:20px auto;width:95%;max-width:1200px;}
.card{background:var(--card-light);backdrop-filter:blur(12px);border-radius:20px;box-shadow:0 8px 25px rgba(0,0,0,.1);margin:20px 0;padding:25px;width:100%;text-align:center;}
body.dark .card{background:var(--card-dark);box-shadow:0 8px 25px rgba(0,0,0,.4);}
.divider{width:50%;height:12px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.4),transparent);border-radius:40px;}

/* Circle SVG */
svg{width:400px;height:400px;}
.note{text-anchor:middle;dominant-baseline:middle;font-size:16px;cursor:pointer;transition:.25s;}
.note:hover{fill:gold;}

/* Fretboard */
.fretboard{display:grid;grid-template-columns:repeat(13,1fr);gap:2px;background:rgba(255,255,255,0.15);border-radius:14px;overflow:hidden;}
.fret{height:32px;display:flex;align-items:center;justify-content:center;font-size:.8em;border-right:1px solid rgba(0,0,0,.1);}
.highlight{background:rgba(255,215,0,0.4);color:#000;font-weight:bold;}
body.dark .highlight{background:rgba(255,215,0,0.35);color:#111;}

/* Modal */
.modal{display:none;position:fixed;z-index:10;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);}
.modal-content{position:relative;margin:8% auto;background:rgba(255,255,255,0.25);backdrop-filter:blur(16px);border-radius:20px;padding:30px;width:90%;max-width:700px;}
.close{position:absolute;right:20px;top:10px;font-size:24px;cursor:pointer;}
</style>
</head>
<body>
<header>
 <h2>Cercle des Quintes ‚Äì Guitare</h2>
 <div>
  <button id="themeBtn">‚òÄÔ∏è/üåô</button>
  <button id="infoBtn">‚ùì Explications</button>
 </div>
</header>

<div class="container">

 <div class="card">
   <svg id="circleSVG" viewBox="0 0 400 400">
     <circle cx="200" cy="200" r="180" fill="none" stroke="#aaa" stroke-width="3"/>
     <g id="circle"></g>
   </svg>
 </div>

 <div class="divider"></div>

 <div class="card">
   <h3>Manche de guitare interactif</h3>
   <div id="fretboard" class="fretboard"></div>
 </div>
</div>

<!-- Modal -->
<div id="modal" class="modal">
 <div class="modal-content">
   <span class="close" id="closeModal">&times;</span>
   <h2>Comprendre le cercle des quintes üé∂</h2>
   <p>Le cercle montre la relation entre les tonalit√©s‚ÄØ: chaque pas vers la droite ajoute un di√®se, vers la gauche un b√©mol. Il relie aussi les gammes majeures et leurs relatives mineures.</p>
   <p>Cliquer sur une note du cercle affiche sa gamme sur le manche et ses accords I‚ÄëIV‚ÄëV.</p>
   <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3f/Circle_of_fifths_deluxe_4.svg/512px-Circle_of_fifths_deluxe_4.svg.png" width="280"/>
 </div>
</div>

<script>
// Data
const majorKeys=["C","G","D","A","E","B","F#","Db","Ab","Eb","Bb","F"];
const notesChrom=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
// major scale intervals (T-T-S-T-T-T-S)
const intervals=[2,2,1,2,2,2,1];

// draw circle
const g=document.getElementById('circle');
majorKeys.forEach((n,i)=>{
 const ang=(i/majorKeys.length)*2*Math.PI-Math.PI/2;
 const x=200+150*Math.cos(ang);
 const y=200+150*Math.sin(ang);
 const t=document.createElementNS("http://www.w3.org/2000/svg","text");
 t.setAttribute('x',x);t.setAttribute('y',y);
 t.classList.add("note");
 t.textContent=n;
 t.onclick=()=>selectKey(n);
 g.appendChild(t);
});

// fretboard build simple 6 strings √ó 13 frets
const fretboard=document.getElementById('fretboard');
const tuning=["E","B","G","D","A","E"];
for(let s=0;s<tuning.length;s++){
 for(let f=0;f<13;f++){
   const div=document.createElement("div");
   div.className="fret";
   div.dataset.string=s; div.dataset.fret=f;
   fretboard.appendChild(div);
 }
}

// compute scale notes
function buildScale(root){
 let idx=notesChrom.indexOf(root);
 if(idx<0) return [];
 const scale=[root];
 intervals.forEach(step=>{
  idx=(idx+step)%12;
  scale.push(notesChrom[idx]);
 });
 return scale;
}

// Update view
function selectKey(key){
 document.querySelectorAll('.highlight').forEach(e=>e.classList.remove('highlight'));
 const scale=buildScale(key);
 highlightFrets(scale);
 alert(`Tonalit√© ${key} majeure : ${scale.join(' - ')}`);
}

// logic fret highlight
function noteAt(string,fret){
 const open=tuning[string];
 const idx=(notesChrom.indexOf(open)+fret)%12;
 return notesChrom[idx];
}
function highlightFrets(scale){
 const frets=document.querySelectorAll('.fret');
 frets.forEach(f=>{
   const s=f.dataset.string,fr=parseInt(f.dataset.fret);
   const n=noteAt(s,fr);
   if(scale.includes(n)){ f.classList.add('highlight'); }
 });
}

// theme toggle
const themeBtn=document.getElementById('themeBtn');
themeBtn.onclick=()=>document.body.classList.toggle('dark');

// modal
const modal=document.getElementById('modal');
document.getElementById('infoBtn').onclick=()=>modal.style.display='block';
document.getElementById('closeModal').onclick=()=>modal.style.display='none';
window.onclick=e=>{if(e.target==modal)modal.style.display='none';};
</script>
</body>
</html>
