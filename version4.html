<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manche Interactif + Cercle des Quintes</title>
<style>
body {
  margin: 0; font-family: Arial, sans-serif;
  background: var(--bg, #f2f3f5); color: var(--fg, #222);
  transition: background .3s, color .3s;
}
header {
  background: var(--panel,#ffffffbb); backdrop-filter: blur(6px);
  padding: 1em; display:flex; justify-content: space-around;
  align-items:center; box-shadow:0 2px 4px #0001;
}
button, select {padding: .3em .6em; border-radius: 6px;}
main {display:flex; flex-direction:column; align-items:center; padding:1em;}
section {display:none; width:100%; max-width:1000px;}
section.active {display:block;}
#fretboard {
  display:grid; grid-template-columns: repeat(13,1fr);
  gap:2px; background:#ccc; padding:10px; border-radius:8px;
}
.string{display:flex;}
.note{
  flex:1; background:#fff; border-radius:50%;
  margin:2px; text-align:center; line-height:28px; font-size:12px;
  cursor:pointer; transition:.2s;
}
.note.active{background:#4caf50;color:white;}
/* circle of fifths */
#circle-container {
  position: relative; width: 380px; height: 380px; margin:1em auto;
}
.key {
  position: absolute; width: 50px; height: 50px; border-radius: 50%;
  line-height: 50px; text-align: center; background:#eee; cursor:pointer;
  transition:.2s;
}
.key:hover,.key.active {background:#4caf50;color:#fff;}
/* theme toggle */
.dark {--bg:#1a1a1a; --fg:#eee; --panel:#222c;}
</style>
</head>
<body>
<header>
  <div>
    Instrument:
    <select id="instrument">
      <option>Guitare</option><option>Basse</option><option>Ukul√©l√©</option>
    </select>
    Frettes: <input type="number" id="frets" min="5" max="24" value="12">
    <button id="refresh">Actualiser</button>
  </div>
  <div>
    <button id="btnFretboard">Manche</button>
    <button id="btnCircle">Cercle des Quintes</button>
    <button id="btnHelp">‚ùì</button>
    <button id="toggleTheme">üåô/‚òÄÔ∏è</button>
  </div>
</header>

<main>
  <section id="secFretboard" class="active">
    <div id="fretboard"></div>
  </section>

  <section id="secCircle">
    <div id="circle-container"></div>
  </section>

  <section id="secHelp">
    <h2>Explications</h2>
    <p>Le cercle des quintes montre la relation entre tonalit√©s majeures et leurs relatives mineures.
      En cliquant sur une tonalit√©, les notes de sa gamme majeure s‚Äôaffichent sur le manche.
      Utilise ce rep√®re pour comprendre les encha√Ænements d‚Äôaccords I-IV-V et les armatures.</p>
  </section>
</main>

<script>
/* --- THEMING --- */
const tbtn=document.getElementById('toggleTheme');
tbtn.onclick=()=>document.body.classList.toggle('dark');

/* --- NAVIGATION --- */
const sF=document.getElementById("secFretboard"),
      sC=document.getElementById("secCircle"),
      sH=document.getElementById("secHelp");
document.getElementById("btnFretboard").onclick=()=>{sF.classList.add("active");sC.classList.remove("active");sH.classList.remove("active");}
document.getElementById("btnCircle").onclick=()=>{sC.classList.add("active");sF.classList.remove("active");sH.classList.remove("active");}
document.getElementById("btnHelp").onclick=()=>{sH.classList.add("active");sC.classList.remove("active");sF.classList.remove("active");}

/* --- MANCHE --- */
const fretboard=document.getElementById("fretboard");
const chrom=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
let tuning=["E","B","G","D","A","E"];
function renderFretboard(){
  fretboard.innerHTML="";
  for(let s=0;s<tuning.length;s++){
    const string=document.createElement("div");
    string.className="string";
    let start=chrom.indexOf(tuning[s]);
    for(let f=0;f<=parseInt(document.getElementById("frets").value);f++){
      const noteDiv=document.createElement("div");
      noteDiv.className="note";
      const note=chrom[(start+f)%12];
      noteDiv.textContent=note;
      string.appendChild(noteDiv);
    }
    fretboard.appendChild(string);
  }
}
renderFretboard();
document.getElementById("refresh").onclick=renderFretboard;

function displayScale(scale){
  document.querySelectorAll('.note').forEach(n=>{
    n.classList.toggle('active', scale.includes(n.textContent));
  });
}

/* --- CERCLE DES QUINTES --- */
const container=document.getElementById("circle-container");
const keys=["C","G","D","A","E","B","F#","Db","Ab","Eb","Bb","F"];
function drawCircle(){
  const r=150;
  for(let i=0;i<keys.length;i++){
    const keyDiv=document.createElement('div');
    keyDiv.className='key';
    const angle=(i/keys.length)*2*Math.PI;
    const x=Math.cos(angle-Math.PI/2)*r+r+40;
    const y=Math.sin(angle-Math.PI/2)*r+r+40;
    keyDiv.style.left=x+'px';
    keyDiv.style.top=y+'px';
    keyDiv.textContent=keys[i];
    keyDiv.onclick=()=>selectKey(keys[i],keyDiv);
    container.appendChild(keyDiv);
  }
}
drawCircle();
function selectKey(key,keyDiv){
  document.querySelectorAll('.key').forEach(k=>k.classList.remove('active'));
  keyDiv.classList.add('active');
  updateFretboardFromCircle(key);
}
function updateFretboardFromCircle(key){
  const pattern=[2,2,1,2,2,2,1];
  let pos=chrom.indexOf(key.includes('b')?flatToSharp(key):key);
  if(pos<0)pos=0;
  const scale=[chrom[pos]];
  pattern.forEach(st=>{pos=(pos+st)%12;scale.push(chrom[pos]);});
  displayScale(scale);
}
function flatToSharp(note){
  const map={"Db":"C#","Eb":"D#","Gb":"F#","Ab":"G#","Bb":"A#"};
  return map[note]||note;
}
</script>
</body>
</html>
