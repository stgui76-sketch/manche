<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cercle des Quintes ‚Äì Version 4 compl√®te</title>
<style>
:root {
  --bg-light: linear-gradient(135deg,#f4f6f9,#dbe4f3);
  --bg-dark: linear-gradient(135deg,#191a1f,#24262b);
}
body {
  margin:0;
  font-family:Poppins, sans-serif;
  background:var(--bg-light);
  color:#222;
  transition:.4s;
}
body.dark {
  background:var(--bg-dark);
  color:#eee;
}
header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:15px 30px;
  backdrop-filter:blur(6px);
  background:rgba(255,255,255,0.15);
}
button {
  border:none;
  padding:10px 16px;
  border-radius:10px;
  background:rgba(255,255,255,0.25);
  color:inherit;
  cursor:pointer;
}
button:hover {
  background:rgba(0,0,0,0.15);
}
.container {
  display:flex;
  flex-direction:column;
  align-items:center;
  margin:20px auto;
  max-width:1200px;
  width:95%;
}
.card {
  background:rgba(255,255,255,0.25);
  border-radius:20px;
  backdrop-filter:blur(14px);
  padding:25px;
  margin:20px 0;
  box-shadow:0 8px 20px rgba(0,0,0,0.15);
  width:100%;
  text-align:center;
}
body.dark .card {
  background:rgba(60,60,70,0.4);
  box-shadow:0 8px 25px rgba(0,0,0,0.7);
}
.divider {
  width:50%;
  height:8px;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,0.4),transparent);
  border-radius:30px;
}

/* SVG Circle */
svg {
  width:440px; height:440px;
}
.note {
  text-anchor:middle;
  dominant-baseline:middle;
  font-size:16px;
  cursor:pointer;
  transition:.2s;
}
.note:hover { fill:gold; }

/* Fretboard */
.fretboard {
  display:grid;
  grid-template-columns:repeat(13,1fr);
  gap:2px;
  background:rgba(255,255,255,0.15);
  border-radius:10px;
}
.fret {
  padding:10px 0;
  border-right:1px solid rgba(0,0,0,0.1);
  font-size:0.8em;
}
.highlight { background:rgba(255,215,0,0.5); font-weight:bold; }

/* Modal */
.modal {display:none;position:fixed;z-index:10;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);}
.modal-content {
  position:relative;
  margin:5% auto;
  background:rgba(255,255,255,0.25);
  backdrop-filter:blur(12px);
  border-radius:20px;
  padding:30px;
  width:90%;
  max-width:700px;
}
.modal .close {position:absolute;top:10px;right:20px;font-size:24px;cursor:pointer;}
</style>
</head>
<body>
<header>
  <h2>Cercle des Quintes ‚Äì Guitare</h2>
  <div>
    <button id="themeToggle">‚òÄÔ∏è/üåô</button>
    <button id="infoBtn">‚ùì Explications</button>
  </div>
</header>

<div class="container">

  <div class="card">
    <svg id="circleSVG" viewBox="0 0 400 400">
      <circle cx="200" cy="200" r="180" fill="none" stroke="#aaa" stroke-width="3"/>
      <g id="circle"></g>
    </svg>
  </div>

  <div class="divider"></div>

  <div class="card">
    <h3>Manche de guitare interactif</h3>
    <div id="fretboard" class="fretboard"></div>
  </div>

</div>

<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeModal">&times;</span>
    <h2>Explications : Le Cercle des Quintes</h2>
    <p>Chaque note repr√©sente une tonalit√© majeure et sa relative mineure. 
    Cliquer sur une tonalit√© met en √©vidence les notes de la gamme sur le manche de guitare.</p>
    <p>Utilise ce cercle pour naviguer les relations harmoniques (I‚ÄëIV‚ÄëV, armatures, transpositions)</p>
  </div>
</div>

<script>
const majorKeys = ["C","G","D","A","E","B","F#","Db","Ab","Eb","Bb","F"];
const chromatic = ["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
const scalePattern = [2,2,1,2,2,2,1];

// Draw circle
const circleGroup = document.getElementById("circle");
majorKeys.forEach((key, i) => {
  const angle = (i / majorKeys.length) * 2 * Math.PI - Math.PI/2;
  const x = 200 + 150 * Math.cos(angle);
  const y = 200 + 150 * Math.sin(angle);
  const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
  text.setAttribute("x", x);
  text.setAttribute("y", y);
  text.textContent = key;
  text.classList.add("note");
  text.onclick = () => selectKey(key);
  circleGroup.appendChild(text);
});

// Build fretboard
const fretboard = document.getElementById('fretboard');
const tuning = ["E","B","G","D","A","E"];
for (let s = 0; s < tuning.length; s++) {
  for (let f = 0; f < 13; f++) {
    const div = document.createElement("div");
    div.className="fret";
    div.dataset.string=s; div.dataset.fret=f;
    fretboard.appendChild(div);
  }
}

function selectKey(key){
  const scale = buildScale(key);
  highlightFrets(scale);
  alert(`Tonalit√© ${key} majeure : ${scale.join(" - ")}`);
}

function buildScale(root){
  let idx = chromatic.indexOf(root);
  const notes=[root];
  for (const step of scalePattern){
    idx=(idx+step)%12;
    notes.push(chromatic[idx]);
  }
  return notes;
}

function noteAt(string, fret){
  const idx = (chromatic.indexOf(tuning[string]) + fret) % 12;
  return chromatic[idx];
}

function highlightFrets(scale){
  document.querySelectorAll(".fret").forEach(f=>{
    f.classList.remove("highlight");
    const note = noteAt(f.dataset.string, parseInt(f.dataset.fret));
    if(scale.includes(note)){ f.classList.add("highlight"); }
  });
}

document.getElementById("themeToggle").onclick = ()=>document.body.classList.toggle("dark");

const modal = document.getElementById("modal");
document.getElementById("infoBtn").onclick = ()=>modal.style.display="block";
document.getElementById("closeModal").onclick = ()=>modal.style.display="none";
window.onclick=e=>{if(e.target==modal)modal.style.display="none";}
</script>
</body>
</html>
