<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cercle des Quintes & Manche — Sélection Guitare</title>
<style>
  body { background: #212121; color: #eee; font-family: sans-serif; margin: 0;}
  header { padding: 18px 8px 2px;}
  h1 { margin:0 0 10px;}
  .toolbar { display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin:12px;}
  .toolbar select, .toolbar input, .toolbar button { padding:6px 12px; font-size:16px; border-radius:8px; border:1px solid #444;}
  #cercleWrapper {margin:12px 0; justify-content: center; display: flex;}
  #cercle {position:relative; width: min(74vw,380px); height:min(74vw,380px); border-radius: 50%; background:#343142; display: flex; align-items:center; justify-content:center;}
  .noteCercle {position:absolute;width:40px;height:40px;border-radius:50%; background:#292;color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;font-weight:700;font-size:14px;}
  .noteCercle.selected {background: #ffb300;}
  #manche { position:relative; margin:24px auto 24px; width:96%; max-width:1360px; height:clamp(220px,40vw,340px); background:#463214; border-radius:12px; overflow:hidden;}
  .fret { position:absolute; top:0; bottom:0; width:2px; background:#b48c5a;}
  .string {position:absolute; left:0; right:0; height:2px; background: #d4b075;}
  .noteManche {position:absolute; width:24px; height:24px; border-radius:50%; background:#e7d6b1; color:#33220e; font-size:13px;font-weight:700; display:flex;align-items:center;justify-content:center;}
  .noteManche.tonic {background:#ffecb3;}
  .noteManche.diese {background:#3378f4;}
  .noteManche.bemol {background:#e55151;}
  #chosenScales { margin: 18px auto 12px; max-width: 900px; background: #191927; border-radius: 12px; padding: 14px 10px; box-shadow: 0 0 14px #0004;}
  #chosenScales ul { padding-left: 18px; }
  #chosenScales strong { color: #ffb300;}
  @media (max-width: 600px) { .toolbar {flex-direction:column;} #cercle {width:220px;height:220px;} #manche{height:180px;} }
</style>
</head>
<body>
<header>
  <h1>Cercle des quintes & manche de guitare — Gammes & modes proposés</h1>
  <div>Clique le cercle des notes puis consulte la liste des gammes & modes suggérés juste en dessous !</div>
</header>

<div class="toolbar">
  <select id="menuGammes" aria-label="Choix gamme"></select>
  <input type="number" min="12" max="36" value="24" id="nbFrettes" title="Nombre de frettes" />
  <select id="menuTuning"></select>
  <button id="helpBtn">?</button>
</div>

<div id="cercleWrapper">
  <div id="cercle" aria-label="Cercle des quintes"></div>
</div>
<div id="chosenScales">
  <strong>Gammes & modes conseillés pour ta sélection de notes :</strong>
  <ul id="recommendedScales"></ul>
</div>
<div id="selectedScale" aria-live="polite"></div>
<div id="manche" aria-label="Manche de guitare"></div>
<footer>v3 — suggestions auto (2025)</footer>

<div id="modalHelp" style="display:none;position:fixed;top:20vh;left:50%;transform:translateX(-50%);background:rgba(30,30,44,0.98);color:#eee;padding:28px 14px;box-shadow:0 0 18px #111;z-index:10;border-radius:16px;">
  <strong>Aide:</strong><br/>
  - Clique sur les notes du cercle pour filtrer les propositions.<br/>
  - Consulte la liste des gammes & modes suggérés.<br/>
  - Utilise le menu pour afficher la gamme sur le manche.<br/>
  <br/><button onclick="document.getElementById('modalHelp').style.display = 'none';">Fermer</button>
</div>

<script>
const SHARP_CHROMA = ['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];
const FLAT_TO_SHARP = { 'Cb':'B','Fb':'E','E#':'F','B#':'C', 'Bb':'A#','Eb':'D#','Ab':'G#','Db':'C#','Gb':'F#'};
function toSharp(n){ return FLAT_TO_SHARP[n] || n; }
const circleLabels = [
  {label:'C',pitch:'C'}, {label:'G',pitch:'G'}, {label:'D',pitch:'D'},
  {label:'A',pitch:'A'}, {label:'E',pitch:'E'}, {label:'B',pitch:'B'},
  {label:'F#/Gb',pitch:'F#'}, {label:'C#/Db',pitch:'C#'},
  {label:'G#/Ab',pitch:'G#'}, {label:'D#/Eb',pitch:'D#'},
  {label:'A#/Bb',pitch:'A#'}, {label:'F',pitch:'F'}
];

const defaultTunings = {
  'Guitare Standard': ['E','A','D','G','B','E'],
  'Basse 4 cordes': ['E','A','D','G'],
  'Guitare Drop D': ['D','A','D','G','B','E'],
  'Guitare 7 cordes': ['B','E','A','D','G','B','E'],
  'Guitare Open G': ['D','G','D','G','B','D']
};

let gammes = {
  'C Majeur': ['C','D','E','F','G','A','B'],
  'A Mineur naturel': ['A','B','C','D','E','F','G'],
  'C Blues': ['C','Eb','F','F#','G','Bb'],
  'G Pentatonique majeure': ['G','A','B','D','E'],
  'F Majeur': ['F','G','A','Bb','C','D','E'],
  'G Mixolydien': ['G','A','B','C','D','E','F'],
  'E Mineur harmonique': ['E','F#','G','A','B','C','D#'],
  'D Dorien': ['D','E','F','G','A','B','C'],
  'A Lydien': ['A','B','C#','D#','E','F#','G#'],
  // Ajoute autant que tu veux !
};

const menuGammes = document.getElementById('menuGammes');
const manche = document.getElementById('manche');
const selTuning = document.getElementById('menuTuning');
const chosenScalesDiv = document.getElementById('chosenScales');
const recommendedScales = document.getElementById('recommendedScales');
const selectedScaleDiv = document.getElementById('selectedScale');

for(const k in defaultTunings){
  let opt = document.createElement('option');
  opt.textContent = k;
  selTuning.appendChild(opt);
}
let tuning = [...defaultTunings['Guitare Standard']];
selTuning.onchange = ()=>{ tuning = [...defaultTunings[selTuning.value]]; drawNeck(); };

let frets = 24;
document.getElementById('nbFrettes').onchange = e=>{ frets = +e.target.value; drawNeck(); };

// == Génération du cercle des quintes + fonction filtre gammes
const cercle = document.getElementById('cercle');
function buildCercle(){
  cercle.innerHTML='';
  circleLabels.forEach((obj, i) => {
    const el = document.createElement('div');
    el.className = 'noteCercle';
    el.textContent = obj.label;
    el.dataset.pitch = obj.pitch;
    const angle = (i * (2*Math.PI) / circleLabels.length) - Math.PI/2;
    const w = cercle.clientWidth, h=cercle.clientHeight;
    const cx = w/2, cy = h/2;
    const radius = Math.min(w,h)*0.39;
    el.style.left = `${cx + Math.cos(angle)*radius - 20}px`;
    el.style.top  = `${cy + Math.sin(angle)*radius - 20}px`;
    el.onclick = () => {
      el.classList.toggle('selected');
      updateGammesFromCircle();
    };
    cercle.appendChild(el);
  });
}
window.addEventListener('resize', buildCercle);
buildCercle();

// == Filtrer gammes selon notes du cercle choisies
function updateGammesFromCircle(){
  const selectedNotes = Array.from(document.querySelectorAll('.noteCercle.selected'))
    .map(el => el.dataset.pitch);

  let possibles = [];
  for (const [name, scale] of Object.entries(gammes)) {
    const scaleSharp = scale.map(toSharp);
    const matching = selectedNotes.every(note => scaleSharp.includes(toSharp(note)));
    if (matching) possibles.push(name);
  }
  fillScales(possibles.length ? possibles : ['(aucune compatible)']);
  showRecommendedScales(possibles, selectedNotes);
}

// == Remplir le menu des gammes
function fillScales(list=null){
  menuGammes.innerHTML = '';
  let gammesList = list || Object.keys(gammes);
  gammesList.forEach(gam => {
    const opt = document.createElement('option');
    opt.textContent = gam;
    menuGammes.appendChild(opt);
  });
  menuGammes.selectedIndex = 0;
  drawNeck();
}
menuGammes.onchange = drawNeck;

// == Affichage liste gammes conseillées (onglet)
function showRecommendedScales(possibles, selectedNotes){
  recommendedScales.innerHTML = '';
  if(selectedNotes.length === 0){
    recommendedScales.innerHTML = '<li>Aucune sélection. Clique des notes sur le cercle.</li>';
    return;
  }
  if(possibles.length === 0){
    recommendedScales.innerHTML = '<li>Aucune gamme ou mode compatible trouvé.</li>';
    return;
  }
  possibles.forEach(name => {
    let scale = gammes[name];
    let item = document.createElement('li');
    item.innerHTML = `<strong>${name}</strong> : <span>${scale.join(', ')}</span>`;
    recommendedScales.appendChild(item);
  });
}

function drawNeck(){
  manche.innerHTML = '';
  const scaleName = menuGammes.value;
  const scale = gammes[scaleName] || [];
  for(let i=0; i<=frets; i++){
    let f = document.createElement('div');
    f.className = 'fret';
    f.style.left = (i/(frets+1))*100+'%';
    manche.appendChild(f);
  }
  tuning.forEach((t, i)=>{
    let s = document.createElement('div');
    s.className = 'string';
    let spacing = manche.clientHeight/(tuning.length+1);
    s.style.top = ((i+1)*spacing)+'px';
    manche.appendChild(s);
  });
  let fretWidth = 100/(frets+1);
  let h = manche.clientHeight;
  let spacing = h/(tuning.length+1);
  tuning.forEach((tune, s)=>{
    const openIndex = SHARP_CHROMA.indexOf(tune);
    for(let f=0; f<=frets; f++){
      const note = SHARP_CHROMA[(openIndex+f)%12];
      const displayNote = scale.includes(note)||scale.includes(Object.keys(FLAT_TO_SHARP).find(b=>FLAT_TO_SHARP[b]===note));
      if(displayNote){
        let el = document.createElement('div');
        el.className = 'noteManche';
        el.textContent = note;
        if(note.includes('#'))el.classList.add('diese');
        if(['Bb','Eb','Ab','Db','Gb'].includes(note))el.classList.add('bemol');
        if(note===scale[0])el.classList.add('tonic');
        el.style.left = `${(f*fretWidth)+fretWidth/2}%`;
        el.style.top = `${(s+1)*spacing}px`;
        manche.appendChild(el);
      }
    }
  });
  selectedScaleDiv.textContent = `${scaleName} — Notes : ${scale.join('  ')}`;
}

// == Bouton aide
document.getElementById('helpBtn').onclick = ()=>{ document.getElementById('modalHelp').style.display='block'; };

fillScales();
drawNeck();
</script>
</body>
</html>
